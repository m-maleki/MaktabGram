@page
@model MaktabGram.Presentation.RazorPages.Pages.Posts.IndexModel

@{
    ViewData["Title"] = "خانه";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

<!-- محتوای اصلی فید -->
<main class="max-w-lg mx-auto px-4 pt-6 pb-24">


    <!-- فید پست‌ها -->
    @if (Model.Feeds != null && Model.Feeds.Any())
    {
        @foreach (var post in Model.Feeds)
        {
            <article class="post-card bg-white rounded-2xl mb-8 overflow-hidden shadow-lg">
                <!-- هدر پست -->
                <div class="flex items-center justify-between p-4">
                    <div class="flex items-center gap-3">
                        <div class="w-11 h-11 rounded-full overflow-hidden border-2 border-gray-300">
                            @if (!string.IsNullOrEmpty(post.ProfileImgUrl))
                            {
                                <img src="/@post.ProfileImgUrl" alt="@post.Username" class="w-full h-full object-cover">
                            }
                            else
                            {
                                <div class="w-full h-full bg-blue-500 flex items-center justify-center text-white font-bold text-lg">
                                    @post.Username.Substring(0, 1).ToUpper()
                                </div>
                            }
                        </div>
                    </div>
                    <button type="button">
                        <i data-lucide="more-horizontal" class="w-6 h-6 text-gray-600"></i>
                    </button>
                </div>

                <!-- تصویر پست + انیمیشن لایک دوبل‌کلیک -->
                <div class="relative bg-black">
                    <div class="post-media-area aspect-square cursor-pointer">
                        <a asp-page="Details" asp-route-id="@post.Id">
                            <img src="/@post.ImgPostUrl" alt="پست @post.Username" class="w-full h-full object-cover">
                        </a>
                        <!-- قلب بزرگ انیمیشنی -->
                        <div class="like-overlay pointer-events-none z-10">
                            <i data-lucide="heart" class="w-24 h-24 text-white fill-white drop-shadow-2xl"></i>
                        </div>
                    </div>
                </div>

                <!-- اکشن‌ها و اطلاعات -->
                <div class="p-4">
                    <!-- دکمه‌های لایک، کامنت، ارسال، بوکمارک -->
                    <div class="flex justify-between items-center mb-3">
                        <div class="flex items-center gap-5">

                            @if(post.UserLikeThisPost)
                            {
                                <a class="action-btn like-btn" asp-page-handler="Dislike" asp-route-id="@post.Id">
                                    <i data-lucide="heart"
                                       class="icon-like w-7 h-7 transition-all fill-red-500 text-red-500"></i>
                                </a>
                            }
                            else
                            {
                                <a class="action-btn like-btn" asp-page-handler="like" asp-route-id="@post.Id">
                                    <i data-lucide="heart"
                                       class="icon-like w-7 h-7 transition-all fill-none text-gray-800"></i>
                                </a>
                            }

                            <button type="button" class="action-btn">
                                <i data-lucide="message-circle" class="w-7 h-7 text-gray-800"></i>
                            </button>
                            <button type="button" class="action-btn">
                                <i data-lucide="send" class="w-7 h-7 text-gray-800"></i>
                            </button>
                        </div>
                        <button type="button" class="action-btn">
                            <i data-lucide="bookmark" class="w-7 h-7 text-gray-800"></i>
                        </button>
                    </div>

                    <!-- تعداد لایک -->
                    <p class="font-bold text-sm mb-2">
                        @post.LikeCount.ToString("N0") نفر این را لایک کرده‌اند
                    </p>

                    <!-- کپشن -->
                    <p class="text-sm leading-relaxed mb-3">
                        <span class="font-bold mr-1">@post.Username</span>
                        @post.Caption
                    </p>

                    <!-- کامنت‌ها -->
                    @if (post.Comments?.Any() == true)
                    {
                        <p class="text-xs text-gray-500 mb-2 cursor-pointer hover:text-gray-700">
                            مشاهده همه @post.Comments.Count کامنت
                        </p>

                        @foreach (var comment in post.Comments.Take(2))
                        {
                            <div class="flex justify-between items-start group mb-3 last:mb-0">
                                <div class="flex-1">
                                    <span class="font-bold text-sm mr-1">@comment.User.Username</span>
                                    <span class="text-sm text-gray-700">@comment.Text</span>
                                </div>
                                @if (comment.CommentLikes is not null)
                                {
                                    <button type="button" class="comment-like-btn opacity-0 group-hover:opacity-100 transition p-1">
                                        <i data-lucide="heart"
                                           class="comment-heart-icon w-4 h-4 @(comment.CommentLikes.Count > 0 ? "fill-red-500 text-red-500" : "text-gray-400")">
                                        </i>
                                        <span class="comment-like-count text-xs text-gray-500 mr-1">@comment.CommentLikes.Count</span>
                                    </button>
                                }
                            </div>
                        }
                    }

                    <!-- تاریخ -->
                    <p class="text-xs text-gray-400 mt-4">
                        @post.CreateAt <!-- یا هر متدی که داری -->
                    </p>
                </div>
            </article>

        }
        <!-- صفحه‌بندی (Pagination) - فقط HTML خالص برای تست -->
        <div class="flex justify-center items-center gap-3 my-12 pb-8">




            @if (Model.Page == 1)
            {
                <!-- دکمه قبلی (غیرفعال) -->
                <div class="w-11 h-11 rounded-full bg-gray-100 flex items-center justify-center cursor-not-allowed opacity-60">
                    <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                </div>
            }
            else
            {
                <!-- دکمه بعدی -->
                <a asp-page="Feeds" asp-route-nextPage="@(Model.Page - 1)" class="w-11 h-11 rounded-full bg-white shadow-md flex items-center justify-center hover:bg-gray-50 ">
                    <i data-lucide="chevron-right" class="w-5 h-5 text-gray-600"></i>
                </a>
            }

            @for (int i = 1; i <= Model.TotalPage; i++)
            {
                <a asp-route-id="@i" asp-page="Feeds" class="w-11 h-11 rounded-full @(i == Model.Page ? "bg-indigo-600" : "bg-white")  shadow-md flex items-center justify-center text-sm font-medium hover:bg-indigo-50 transition">
                    @i
                </a>
            }


            @if(Model.Page == Model.TotalPage)
            {
                <div class="w-11 h-11 rounded-full bg-gray-100 flex items-center justify-center cursor-not-allowed opacity-60">
                    <i data-lucide="chevron-left" class="w-5 h-5 text-gray-400"></i>
                </div>
            }
            else
            {
                <!-- دکمه بعدی -->
                <a asp-page="Feeds" asp-route-nextPage="@(Model.Page + 1)" class="w-11 h-11 rounded-full bg-white shadow-md flex items-center justify-center hover:bg-gray-50 ">
                    <i data-lucide="chevron-left" class="w-5 h-5 text-gray-600"></i>
                </a>
            }
          

        </div>

        <!-- متن کوچک زیر صفحه‌بندی (اختیاری) -->
        <p class="text-center text-xs text-gray-500">
            صفحه @Model.Page از @Model.TotalPage (@Model.PostCount پست)
        </p>
    }
    else
    {
        <div class="text-center py-20">
            <i data-lucide="image-off" class="w-24 h-24 text-gray-300 mx-auto mb-4"></i>
            <p class="text-lg text-gray-500 font-medium">هنوز پستی منتشر نشده</p>
            <p class="text-sm text-gray-400 mt-2">اولین پست خودت رو بساز!</p>
        </div>
    }
</main>
